---
layout: single
title: "[OAuth 2.0] 3. OAuth의 동작 방식 - Authorization Code Grant Flow"
categories : oauth
tag : [인증, login, token, OAuth]
author_profile: true
sidebar_main: true
toc: true
toc_label: Index
toc_sticky: true
---
## RELATED POSTS                                         
- [1. 사전 지식 - http통신, session, cookie, token은 무엇인가](https://iamhmin.github.io/oauth/oauth-1/) 
- [2. OAuth의 개념, 주요 용어, 플로우 타입 ](https://iamhmin.github.io/oauth/oauth-2/)      
- [3. OAuth의 동작 방식 - Authorization Code Grant Flow ](https://iamhmin.github.io/oauth/oauth-3/)    

## OAuth의 동작 방식
지난 포스팅에서 OAuth의 개념에 대해서 간단하게 정리해보았다. 이번 포스팅에서는, 카카오 서비스를 예로 들어 OAuth가 어떻게 동작하는지 좀더 상세하게 정리해보려고 한다.

### 1. 준비
먼저 resource server에 우리가 만들 애플리케이션(client)정보를 등록해야한다. 카카오같은 경우는 [여기(kakao developer)](https://developers.kakao.com/)에서 등록할 수 있으며, 등록 예시는 구글에 매우 많다. 

client 도메인과 resource server로부터 authorization code를 리턴받을 redirect uri등록하면, client_id와 secret을 발급해준다. 잘 관리하자! client_secret은 보안상 절대로 노출되선 안된다. 

resource owner로부터 어떤 항목까지 자원을 받을 것인가(scope)도 설정하게 된다. 예를 들면 email, profile등이 있다. 여기까지 마치면, 이제 authorization code와 access token을 받을 준비가 되었다.


### 2. Authorization Code Flow
![Alt text](/assets/images/oauth.png)

1. resource owner(user)가 client에 로그인하여 서비스를 이용하고자 한다고 가정하자. user가 로그인 버튼을 누르면, client는 authorization code request를 보내게 된다. 이때 파라미터로 어떤 애플리케이션인지 확인하기 위한 client_id, authorization code가 리다이렉트될 redirect_uri를 보내게 된다.
2. authorization server로 리다이렉트되고, 유저가 로그인/동의를 실행한다.
4. 유저는 client로 리다이렉트되며, client는 다음과 같은 형식으로 일회성의 authorization code를 제공받는다.
```
http://localhost:3000/callback?code=thisisauthorizationcode
```
5. 이제 access token을 요청할 차례이다. authorization code, client Id, client secret등을 authorization server로 포워딩한다. authorization server는 authorization code로 정보를 요청하는 client가 올바른 client인지 client_secret을 통해 검증하고, access token을 생성하여 제공한다. 
7. client는 이제 access token을 이용하여 resource server의 target API에 접근할 수 있다.


## 추천링크
Oauth의 기본적인 개념을 이해하기 위해서 다음을 추천한다.

[생활코딩](https://www.youtube.com/watch?v=hm2r6LtUbk8&list=PLuHgQVnccGMA4guyznDlykFJh28_R08Q-&index=1) 에서는 개념정리를 굉장히 잘 해주셨고,

[김코더 김주역](https://kimcoder.tistory.com/342?category=962287) 블로그에는 oauth의 다양한 예제를 포스팅해두셨다.
 


